<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Leads Profissional - Sistema H√≠brido</title>
    <link rel="stylesheet" href="style.css">
    <!-- √çcones -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Biblioteca para Exportar/Importar Excel (SheetJS) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>

    <!-- SISTEMA DE LOGIN -->
    <section id="auth-section">
        <div class="auth-container">
            <div class="auth-box" id="login-box">
                <h2>Acesso ao Sistema</h2>
                <p>Gerador de Leads Profissional</p>
                <form id="login-form">
                    <input type="text" id="login-name" placeholder="Seu Nome (Opcional)" >
                    <input type="email" id="login-email" placeholder="Seu e-mail" required>
                    <input type="password" id="login-password" placeholder="Sua senha" required>
                    <button type="submit" class="btn-primary">Entrar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-register">Criar conta</a> | 
                    <a href="#" id="link-forgot">Esqueci minha senha</a>
                </div>
            </div>

            <div class="auth-box hidden" id="register-box">
                <h2>Criar Conta</h2>
                <form id="register-form">
                    <input type="hidden" id="register-mode-select" value="hybrid">
                    <input type="text" id="reg-name" placeholder="Seu Nome Completo" required>
                    <input type="email" id="reg-email" placeholder="Seu e-mail" required>
                    <input type="password" id="reg-password" placeholder="Crie uma senha" required>
                    <button type="submit" class="btn-primary">Cadastrar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-login-reg">Voltar para Login</a>
                </div>
            </div>

            <div class="auth-box hidden" id="forgot-box">
                <h2>Recuperar Senha</h2>
                <p>Informe seu e-mail para receber as instru√ß√µes.</p>
                <form id="forgot-form">
                    <input type="email" id="forgot-email" placeholder="E-mail cadastrado" required>
                    <button type="submit" class="btn-primary">Recuperar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-login-forgot">Voltar para Login</a>
                </div>
            </div>
        </div>
    </section>

    <!-- APLICA√á√ÉO PRINCIPAL -->
    <section id="app-section" class="hidden">
        <header>
            <div class="header-content">
                <div class="user-info">
                    <span>Ol√°, <strong id="user-name-display">Visitante</strong> <small id="app-mode-display"></small></span>
                </div>
                <div class="header-actions">
                    <button id="btn-sync-data" class="btn-outline" title="Sincronizar dados locais com a nuvem">
                        <i class="fas fa-sync-alt"></i> Sync Nuvem
                    </button>
                    <button id="btn-show-saved-leads" class="btn-primary-outline">
                        <i class="fas fa-address-book"></i> Meus Contatos
                    </button>
                    <!-- BOT√ÉO ADICIONADO PARA GERENCIAR BANCO -->
                    <button id="btn-db-manager" class="btn-outline">
                        <i class="fas fa-database"></i> Gerenciar Banco
                    </button>
                    <button id="btn-admin-add" class="btn-outline btn-admin-success hidden">
                        <i class="fas fa-plus-circle"></i> +10 Leads
                    </button>
                    <button id="btn-admin-reset" class="btn-outline btn-admin-danger hidden">
                        <i class="fas fa-trash"></i> Zerar Saldo
                    </button>
                    <button id="btn-config" class="btn-secondary"><i class="fas fa-cog"></i> Configura√ß√µes</button>
                    <button id="btn-logout" class="btn-outline">Sair</button>
                </div>
            </div>
        </header>

        <main>
            <div class="search-panel">
                <h1>Filtro de Leads (ICP)</h1>
                <p>Localize potenciais clientes e gere oportunidades reais.</p>
                
                <form id="lead-search-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="niche">Nicho / Profiss√£o</label>
                            <input type="text" id="niche" placeholder="Ex: Restaurantes, Advogados..." required>
                        </div>
                        <div class="form-group">
                            <label for="city">Cidade</label>
                            <input type="text" id="city" placeholder="Ex: S√£o Paulo">
                        </div>
                        <div class="form-group">
                            <label for="state">Estado (UF)</label>
                            <select id="state">
                                <option value="">Todos</option>
                                <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option><option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option><option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option><option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option><option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option><option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option><option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="limit">Quantidade (M√°x 100)</label>
                            <input type="number" id="limit" value="100" min="1" max="100">
                        </div>
                    </div>

                    <div class="form-group template-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label for="message-template-input">Mensagem de Abordagem (Edit√°vel)</label>
                            <small class="input-hint" style="margin:0;">Vari√°veis: {nicho}, {cidade}, {estado}</small>
                        </div>
                        <textarea id="message-template-input" rows="8"></textarea>
                        <div class="template-controls-mini">
                            <button type="button" id="btn-load-default-msg" class="btn-action">Restaurar Texto Padr√£o</button>
                        </div>
                    </div>

                    <button type="submit" id="btn-search-leads" class="btn-primary full-width"><i class="fas fa-search"></i> Buscar Leads</button>
                    
                    <button type="button" id="btn-save-db-direct" class="btn-success full-width" style="margin-top: 10px;">
                        <i class="fas fa-save"></i> Salvar Leads na Minha Lista
                    </button>
                </form>
                
                <div id="api-status-warning" class="warning-box hidden">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <span id="api-warning-text">Chave API n√£o configurada. Exibindo <strong>leads fict√≠cios</strong>.</span>
                </div>
                <div id="api-status-success" class="success-box hidden">
                    <i class="fas fa-database"></i> 
                    <span style="flex:1;">API Ativa (<span id="api-provider-badge">Serper</span>). <strong>Saldo: <span id="leads-balance-display">0</span></strong></span>
                </div>
                <div id="api-status-expired" class="error-box hidden">
                    <i class="fas fa-ban"></i> 
                    <span>Saldo Esgotado. Modo Simula√ß√£o Ativo. <button id="btn-revalidate-trigger" class="btn-link">Recarregar</button></span>
                </div>
            </div>

            <div class="results-panel hidden" id="results-panel">
                <div class="results-header">
                    <h2 id="results-title">Resultados <span id="data-source-badge" class="badge-fictitious">...</span>: <span id="result-count">0</span></h2>
                    <div class="export-buttons">
                        <button id="btn-import-xlsx" class="btn-outline btn-sm btn-import"><i class="fas fa-file-upload"></i> Importar Excel</button>
                        <input type="file" id="import-file-input" class="hidden" accept=".xlsx">
                        <button id="btn-export-csv" class="btn-outline btn-sm"><i class="fas fa-file-csv"></i> CSV</button>
                        <button id="btn-export-xlsx" class="btn-outline btn-sm"><i class="fas fa-file-excel"></i> Excel</button>
                    </div>
                </div>

                <div class="filters-container">
                    <div class="filter-group"><label>Buscar</label><input type="text" id="filter-text" placeholder="Nome/Geral"></div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="filter-status">
                            <option value="">Todos</option>
                            <option value="Novo">Novo</option>
                            <option value="Contatado">Contatado</option>
                            <option value="Interessado">Interessado</option>
                            <option value="Negocia√ß√£o">Negocia√ß√£o</option>
                            <option value="Convertido">Convertido</option>
                            <option value="N√£o interessado">N√£o interessado</option>
                        </select>
                    </div>
                    <div class="filter-group"><label>Nicho</label><select id="filter-niche"><option value="">Todos</option></select></div>
                </div>
                
                <div class="table-responsive">
                    <table id="leads-table">
                        <thead>
                            <tr>
                                <th>Empresa / Status</th>
                                <th>Detalhes (Nicho, Local)</th>
                                <th>Contato</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="leads-body"></tbody>
                    </table>
                </div>
                <div id="pagination-controls" class="pagination-container hidden"></div>
            </div>
        </main>

        <!-- MODAL: GERENCIAR BANCO DE DADOS -->
        <div id="database-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal-db">&times;</span>
                <h3>üì¶ Gerenciar Banco de Dados</h3>
                <p>A√ß√µes globais sobre seus contatos salvos.</p>
                <div class="db-filter-box">
                    <label for="db-niche-select">Filtrar por Nicho salvo:</label>
                    <select id="db-niche-select"><option value="">Carregando...</option></select>
                </div>
				<!-- Dentro de <div id="database-modal"> ... <div class="db-actions"> -->
<button id="btn-delete-no-niche" class="btn-action-db btn-admin-danger" style="margin-top: 10px; background-color: #fef2f2;">
    <i class="fas fa-eraser"></i> Excluir registros sem nicho
</button>
                <div class="db-actions">
                    <button id="btn-download-delete-csv" class="btn-action-db btn-csv"><i class="fas fa-file-csv"></i> Baixar CSV e Limpar Nicho</button>
                    <button id="btn-download-delete-xlsx" class="btn-action-db btn-excel"><i class="fas fa-file-excel"></i> Baixar Excel e Limpar Nicho</button>
                    <hr>
                    <!-- NOVO BOT√ÉO INTEGRADO -->
                    <button id="btn-delete-no-niche" class="btn-admin-danger" style="width:100%; margin-top:10px;">
                        <i class="fas fa-eraser"></i> Excluir registros sem nicho
                    </button>
                </div>
                <div id="db-status-msg" class="validation-msg"></div>
            </div>
        </div>

        <!-- MODAL: CONFIGURA√á√ïES -->
        <div id="config-modal" class="modal hidden">
            <div class="modal-content large-modal">
                <span class="close-modal">&times;</span>
                <div class="config-tabs">
                    <button class="tab-btn active" data-tab="tab-api">API & Leads</button>
                    <button class="tab-btn" data-tab="tab-templates">Templates</button>
                    <button class="tab-btn" data-tab="tab-data">Armazenamento</button>
                </div>
                <div id="tab-api" class="tab-content active">
                    <div class="config-section">
                        <select id="api-provider-select" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                            <option value="KEY_1">Chave 1 (Serper)</option>
                            <option value="KEY_2">Chave 2 (SerpAPI)</option>
                        </select>
                        <button id="save-api-key" class="btn-primary">Salvar Prefer√™ncia</button>
                        <p id="api-validation-msg" class="validation-msg"></p>
                    </div>
                    <div id="revalidation-area" class="config-section hidden revalidation-box">
                        <p>C√≥digo Gerado: <strong id="challenge-number" class="highlight-number">---</strong> <button id="btn-generate-challenge" class="btn-secondary btn-sm">Gerar</button></p>
                        <input type="number" id="leads-quantity" placeholder="Qtd Leads" style="width:80px">
                        <a href="#" id="btn-whatsapp-request" target="_blank" class="btn-whatsapp">Solicitar Contra-senha</a>
                        <div class="response-box" style="margin-top:10px;">
                            <input type="text" id="challenge-response" placeholder="Ex: 12345-500">
                            <button id="btn-verify-challenge" class="btn-primary">Ativar</button>
                        </div>
                    </div>
                </div>
                <div id="tab-templates" class="tab-content">
                    <div class="new-template-form">
                        <input type="text" id="new-template-name" placeholder="Nome do Modelo">
                        <textarea id="new-template-content" rows="4" placeholder="Texto da mensagem..."></textarea>
                        <button id="btn-save-template" class="btn-secondary">Salvar Modelo</button>
                    </div>
                    <ul id="templates-list" class="templates-list"></ul>
                </div>
                <div id="tab-data" class="tab-content">
                    <select id="app-storage-mode" style="width:100%; padding:10px; margin-bottom:10px;">
                        <option value="local">Local (Offline)</option>
                        <option value="cloud">Nuvem (Online)</option>
                        <option value="hybrid">H√≠brido (Sincronizado)</option>
                    </select>
                    <button id="btn-save-storage-mode" class="btn-primary">Salvar Modo</button>
                    <hr>
                    <div class="backup-actions">
                        <button id="btn-backup" class="btn-backup"><i class="fas fa-download"></i> Backup JSON</button>
                        <button id="btn-restore-trigger" class="btn-restore"><i class="fas fa-upload"></i> Restaurar</button>
                        <input type="file" id="restore-file-input" class="hidden">
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: DETALHES LEAD -->
        <div id="lead-details-modal" class="modal hidden">
            <div class="modal-content large-modal">
                <span class="close-modal-details">&times;</span>
                <h3 id="detail-name">Nome do Neg√≥cio</h3>
                <div class="lead-details-grid">
                    <div class="detail-section">
                        <p>Telefone: <span id="detail-phone"></span></p>
                        <p>Nicho: <span id="detail-niche-badge" class="badge-niche"></span></p>
                        <p>Endere√ßo: <span id="detail-address"></span></p>
                    </div>
                    <div class="highlight-section">
                        <label>Status:</label>
                        <select id="detail-status" style="width:100%; margin-bottom:10px;">
                            <option value="Novo">Novo</option>
                            <option value="Contatado">Contatado</option>
                            <option value="Interessado">Interessado</option>
                            <option value="Negocia√ß√£o">Negocia√ß√£o</option>
                            <option value="Convertido">Convertido</option>
                            <option value="N√£o interessado">N√£o interessado</option>
                        </select>
                        <label>Notas:</label>
                        <textarea id="detail-notes" rows="3" style="width:100%;"></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="btn-save-details" class="btn-primary">Salvar Altera√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- MODAL: ABORDAGEM -->
        <div id="message-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal-msg">&times;</span>
                <h3>Gerador de Abordagem</h3>
                <select id="modal-template-select" class="modal-template-selector"></select>
                <textarea id="generated-message" rows="8" style="width:100%; margin: 10px 0;"></textarea>
                <button id="copy-message" class="btn-secondary">Copiar Mensagem</button>
                <a id="btn-send-whatsapp" href="#" target="_blank" class="btn-whatsapp-action">Enviar no WhatsApp</a>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 Gerador de Leads. <a href="https://www.websitelog.com.br" target="_blank">www.websitelog.com.br</a></p>
        </footer>
    </section>

    <script src="script.js"></script>
</body>
</html>