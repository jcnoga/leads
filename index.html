<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Leads Profissional - Prospec√ß√£o Estrat√©gica</title>
    <link rel="stylesheet" href="style.css">
    <!-- √çcones -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Biblioteca para Exportar Excel (SheetJS) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>

    <!-- SISTEMA DE LOGIN -->
    <section id="auth-section">
        <div class="auth-container">
            <div class="auth-box" id="login-box">
                <h2>Acesso ao Sistema</h2>
                <p>Gerador de Leads Profissional</p>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Seu e-mail" required>
                    <input type="password" id="login-password" placeholder="Sua senha" required>
                    <button type="submit" class="btn-primary">Entrar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-register">Criar conta</a> | 
                    <a href="#" id="link-forgot">Esqueci minha senha</a>
                </div>
            </div>

            <div class="auth-box hidden" id="register-box">
                <h2>Criar Conta</h2>
                <form id="register-form">
                    <input type="text" id="reg-name" placeholder="Seu Nome Completo" required>
                    <input type="email" id="reg-email" placeholder="Seu e-mail" required>
                    <input type="password" id="reg-password" placeholder="Crie uma senha" required>
                    <button type="submit" class="btn-primary">Cadastrar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-login-reg">Voltar para Login</a>
                </div>
            </div>

            <div class="auth-box hidden" id="forgot-box">
                <h2>Recuperar Senha</h2>
                <p>Informe seu e-mail para receber as instru√ß√µes.</p>
                <form id="forgot-form">
                    <input type="email" id="forgot-email" placeholder="E-mail cadastrado" required>
                    <button type="submit" class="btn-primary">Recuperar</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-login-forgot">Voltar para Login</a>
                </div>
            </div>
        </div>
    </section>

    <!-- APLICA√á√ÉO PRINCIPAL (Vis√≠vel apenas ap√≥s login) -->
    <section id="app-section" class="hidden">
        <header>
            <div class="header-content">
                <div class="user-info">
                    <span>Ol√°, <strong id="user-name-display">Visitante</strong></span>
                </div>
                <div class="header-actions">
                    <!-- Bot√£o Admin (Invis√≠vel por padr√£o) -->
                    <button id="btn-admin-reset" class="btn-outline hidden" style="border-color: red; color: red;">
                        <i class="fas fa-trash"></i> Zerar Saldo (Admin)
                    </button>
                    
                    <!-- Bot√£o Salvar Leads -->
                    <button id="btn-database" class="btn-primary-outline"><i class="fas fa-save"></i> Salvar Leads</button>
                    
                    <button id="btn-config" class="btn-secondary"><i class="fas fa-cog"></i> Configura√ß√µes</button>
                    <button id="btn-logout" class="btn-outline">Sair</button>
                </div>
            </div>
        </header>

        <main>
            <div class="search-panel">
                <h1>Filtro de Leads (ICP)</h1>
                <p>Localize potenciais clientes e gere oportunidades reais.</p>
                
                <form id="lead-search-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="niche">Nicho / Profiss√£o</label>
                            <input type="text" id="niche" placeholder="Ex: Restaurantes, Advogados..." required>
                        </div>
                        <div class="form-group">
                            <label for="city">Cidade</label>
                            <input type="text" id="city" placeholder="Ex: S√£o Paulo">
                        </div>
                        <div class="form-group">
                            <label for="state">Estado (UF)</label>
                            <select id="state">
                                <option value="">Todos</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="limit">Quantidade (M√°x 200)</label>
                            <input type="number" id="limit" value="10" min="1" max="200">
                        </div>
                    </div>

                    <!-- SELE√á√ÉO DE TEMPLATE NA BUSCA -->
                    <div class="form-group template-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label for="message-template-input">Mensagem de Abordagem (Edit√°vel)</label>
                            <small class="input-hint" style="margin:0;">Vari√°veis: {nicho}, {cidade}, {estado}</small>
                        </div>
                        <textarea id="message-template-input" rows="8"></textarea>
                        <div class="template-controls-mini">
                            <button type="button" id="btn-load-default-msg" class="btn-action">Restaurar Texto Padr√£o</button>
                        </div>
                    </div>

                    <!-- Bot√£o de Busca -->
                    <button type="submit" id="btn-search-leads" class="btn-primary full-width"><i class="fas fa-search"></i> Buscar Leads</button>
                </form>
                
                <!-- Status da API / Leads -->
                <div id="api-status-warning" class="warning-box hidden">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <span id="api-warning-text">Chave API n√£o configurada. Exibindo <strong>leads fict√≠cios</strong>.</span>
                </div>
                
                <div id="api-status-success" class="success-box hidden">
                    <i class="fas fa-database"></i> 
                    <span style="flex:1;">API Ativa. <strong>Saldo de Leads: <span id="leads-balance-display">0</span></strong></span>
                </div>

                <div id="api-status-expired" class="error-box hidden">
                    <i class="fas fa-ban"></i> 
                    <span>Saldo de Leads Esgotado (0). Modo Simula√ß√£o Ativo. <button id="btn-revalidate-trigger" class="btn-link">Recarregar</button></span>
                </div>
            </div>

            <div class="results-panel hidden" id="results-panel">
                
                <!-- PAINEL RESUMIDO DE INDICADORES (NOVO) -->
                <div class="dashboard-stats">
                    <div class="dash-header">
                        <h3><i class="fas fa-chart-pie"></i> Resumo de Leads</h3>
                    </div>
                    <div class="dash-grid">
                        <div class="dash-card">
                            <span class="dash-label">Total de Leads</span>
                            <span class="dash-value" id="metric-total">0</span>
                            <span class="dash-sub">Base Completa</span>
                        </div>
                        <div class="dash-card">
                            <span class="dash-label">Novos Leads</span>
                            <span class="dash-value text-blue" id="metric-new">0</span>
                            <span class="dash-sub">Aguardando Contato</span>
                        </div>
                        <div class="dash-card">
                            <span class="dash-label">Em Andamento</span>
                            <span class="dash-value text-orange" id="metric-progress">0</span>
                            <span class="dash-sub">Ativos no Funil</span>
                        </div>
                        <div class="dash-card">
                            <span class="dash-label">Taxa de Convers√£o</span>
                            <span class="dash-value text-green" id="metric-rate">0,0%</span>
                            <span class="dash-sub">Convertidos: <span id="metric-converted">0</span></span>
                        </div>
                    </div>
                </div>

                <div class="results-header">
                    <div class="header-left">
                        <h2>Resultados <span id="data-source-badge" class="badge-fictitious">(Simulados)</span></h2>
                        <!-- SELETOR DE HIST√ìRICO (NOVO) -->
                        <div class="batch-filter-container">
                            <select id="batch-filter" class="form-select-sm">
                                <option value="current">Busca Atual</option>
                                <option disabled>-- Hist√≥rico Salvo --</option>
                                <!-- Op√ß√µes populadas via JS -->
                            </select>
                            <button id="btn-refresh-history" class="btn-icon" title="Atualizar Hist√≥rico"><i class="fas fa-sync-alt"></i></button>
                        </div>
                    </div>
                    
                    <!-- BOT√ïES DE EXPORTA√á√ÉO -->
                    <div class="export-buttons">
                        <!-- NOVO BOT√ÉO: SALVAR LEADS (SILENCIOSO) -->
                        <button id="btn-save-manual" class="btn-outline btn-sm btn-save-action"><i class="fas fa-cloud-upload-alt"></i> Salvar Leads</button>
                        
                        <button id="btn-export-csv" class="btn-outline btn-sm"><i class="fas fa-file-csv"></i> Baixar CSV</button>
                        <button id="btn-export-xlsx" class="btn-outline btn-sm"><i class="fas fa-file-excel"></i> Baixar Excel</button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table id="leads-table">
                        <thead>
                            <tr>
                                <th>Lead / Detalhes</th>
                                <th>Contato</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="leads-body">
                            <!-- Leads ser√£o inseridos aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Modal de Configura√ß√£o -->
        <div id="config-modal" class="modal hidden">
            <div class="modal-content large-modal">
                <span class="close-modal">&times;</span>
                <h3>Configura√ß√µes do Sistema</h3>
                
                <div class="config-tabs">
                    <button class="tab-btn active" data-tab="tab-api">API & Leads</button>
                    <button class="tab-btn" data-tab="tab-templates">Cadastrar Textos</button>
                </div>

                <!-- TAB API -->
                <div id="tab-api" class="tab-content active">
                    <div class="config-section">
                        <h4>Configura√ß√£o da API de Busca</h4>
                        <p>Insira sua chave da API de Busca para habilitar a conex√£o com dados reais.</p>
                        <input type="text" id="api-key-input" placeholder="Cole sua API Key aqui (ex: 8847d...)">
                        <button id="save-api-key" class="btn-primary">Salvar a chave</button>
                        <p id="api-validation-msg" class="validation-msg"></p>
                    </div>

                    <!-- √Årea de Recarga de Leads -->
                    <div id="revalidation-area" class="config-section hidden revalidation-box">
                        <h4>üíé Recarga de Leads (Senha/Contra-Senha)</h4>
                        <p>Para adicionar leads ao seu saldo, siga os passos:</p>
                        
                        <div class="recharge-steps">
                            <div class="step-box">
                                <label>1. C√≥digo Gerado:</label>
                                <div class="challenge-row">
                                    <strong id="challenge-number" class="highlight-number">---</strong>
                                    <button id="btn-generate-challenge" class="btn-secondary btn-sm">Gerar</button>
                                </div>
                            </div>

                            <div class="step-box">
                                <label>2. Quero adquirir (Qtd):</label>
                                <input type="number" id="leads-quantity" placeholder="Ex: 500" min="1">
                            </div>

                            <div class="step-box full">
                                <label>3. Solicitar Contra-senha:</label>
                                <a href="#" id="btn-whatsapp-request" target="_blank" class="btn-whatsapp">
                                    <i class="fab fa-whatsapp"></i> Enviar C√≥digo e Pedido via WhatsApp
                                </a>
                            </div>

                            <div class="step-box full">
                                <label>4. Inserir Contra-senha:</label>
                                <div class="response-box">
                                    <input type="text" id="challenge-response" placeholder="Ex: 12345-500">
                                    <button id="btn-verify-challenge" class="btn-primary">Ativar Leads</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB TEMPLATES -->
                <div id="tab-templates" class="tab-content">
                    <div class="config-section">
                        <h4>Gerenciar Modelos de Mensagem</h4>
                        <p>Cadastre textos para usar nas abordagens.</p>
                        
                        <div class="new-template-form">
                            <input type="text" id="new-template-name" placeholder="Nome do Modelo (ex: Abordagem Formal)">
                            <textarea id="new-template-content" rows="6" placeholder="Texto da mensagem com vari√°veis {nicho}, {cidade}..."></textarea>
                            <button id="btn-save-template" class="btn-secondary">Adicionar Modelo</button>
                        </div>

                        <div class="templates-list-container">
                            <h5>Modelos Salvos</h5>
                            <ul id="templates-list" class="templates-list">
                                <!-- Lista gerada via JS -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: Gerenciar Banco de Leads (Exportar e Limpar) -->
        <div id="database-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal-db">&times;</span>
                <h3>üì¶ Salvar Leads (Banco de Dados)</h3>
                <p>Selecione um nicho para baixar e remover do banco de dados.</p>
                
                <div class="db-filter-box">
                    <label for="db-niche-select">Filtrar por Nicho salvo:</label>
                    <select id="db-niche-select">
                        <option value="">Carregando nichos...</option>
                    </select>
                </div>

                <div class="db-actions">
                    <button id="btn-download-delete-csv" class="btn-action-db btn-csv">
                        <i class="fas fa-file-csv"></i> Baixar CSV e Limpar
                    </button>
                    <button id="btn-download-delete-xlsx" class="btn-action-db btn-excel">
                        <i class="fas fa-file-excel"></i> Baixar Excel e Limpar
                    </button>
                </div>
                
                <div id="db-status-msg" class="validation-msg" style="margin-top:10px;"></div>
            </div>
        </div>

        <!-- NOVO MODAL: Detalhes e Gerenciamento do Lead -->
        <div id="lead-details-modal" class="modal hidden">
            <div class="modal-content large-modal">
                <span class="close-modal-details">&times;</span>
                <h3><i class="fas fa-user-edit"></i> Gerenciar Lead</h3>
                
                <div class="lead-details-grid">
                    <!-- Nome do Lead -->
                    <div class="detail-header">
                        <h2 id="detail-name">Nome do Neg√≥cio</h2>
                        <span id="detail-niche-badge" class="badge-niche">Nicho</span>
                    </div>

                    <!-- Se√ß√£o Contato -->
                    <div class="detail-section">
                        <h4>üìû Contato</h4>
                        <div class="detail-row">
                            <strong>Telefone / WhatsApp:</strong>
                            <span id="detail-phone">...</span>
                        </div>
                        <div class="detail-row">
                            <strong>Website:</strong>
                            <a href="#" id="detail-website" target="_blank">...</a>
                        </div>
                    </div>

                    <!-- Se√ß√£o Observa√ß√µes -->
                    <div class="detail-section">
                        <h4>üìå Observa√ß√µes</h4>
                        <div class="detail-row-grid">
                            <div>‚≠ê Avalia√ß√£o: <span id="detail-rating">...</span></div>
                            <div>üìù Total de avalia√ß√µes: <span id="detail-rating-count">...</span></div>
                            <div>üìç Atividade: <span id="detail-activity">...</span></div>
                        </div>
                        <div class="detail-address-box">
                            <strong>üè¢ Endere√ßo:</strong>
                            <p id="detail-address">...</p>
                        </div>
                    </div>

                    <!-- Se√ß√£o Gerenciar -->
                    <div class="detail-section highlight-section">
                        <h4>üóÇÔ∏è Gerenciar Lead</h4>
                        
                        <div class="form-group">
                            <label for="detail-status">Status do Lead:</label>
                            <select id="detail-status">
                                <option value="Novo">Novo</option>
                                <option value="Contatado">Contatado</option>
                                <option value="Interessado">Interessado</option>
                                <option value="Negocia√ß√£o">Negocia√ß√£o</option>
                                <option value="Convertido">Convertido</option>
                                <option value="N√£o interessado">N√£o interessado</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="detail-notes">Notas de Follow-up:</label>
                            <textarea id="detail-notes" rows="4" placeholder="Adicione observa√ß√µes sobre o contato, pr√≥ximos passos..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Bot√µes de A√ß√£o -->
                <div class="modal-actions">
                    <button id="btn-cancel-details" class="btn-outline">Cancelar</button>
                    <button id="btn-save-details" class="btn-primary">Salvar Altera√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- Modal de Abordagem -->
        <div id="message-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal-msg">&times;</span>
                <h3>Gerador de Abordagem</h3>
                <div class="message-box">
                    <textarea id="generated-message" rows="8"></textarea>
                </div>
                <button id="copy-message" class="btn-secondary">Copiar Mensagem</button>
                <a id="btn-send-whatsapp" href="#" target="_blank" class="btn-whatsapp-action">Enviar no WhatsApp</a>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 Gerador de Leads Profissional. Todos os direitos reservados.</p>
            <a href="https://www.websitelog.com.br" target="_blank">www.websitelog.com.br</a>
        </footer>
    </section>

    <script src="script.js"></script>
</body>
</html>