<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP Financeiro Profissional Completo</title>
    
    <!-- Link para o arquivo de estilos externo -->
    <link rel="stylesheet" href="style.css">
    
    <!-- 1. SEGURANÃ‡A: Bloqueio de execuÃ§Ã£o local (file://) -->
    <!-- Mantido no HTML para execuÃ§Ã£o imediata antes do render da pÃ¡gina -->
    <script>
        if (window.location.protocol === "file:") {
            document.documentElement.innerHTML = ""; // Limpa a tela
            alert("âš ï¸ Acesso Negado âš ï¸\n\nPor motivos de seguranÃ§a, este aplicativo nÃ£o pode ser executado diretamente do arquivo (duplo clique).\n\nPor favor, utilize o link oficial hospedado ou um servidor local.");
            throw new Error("ExecuÃ§Ã£o local bloqueada."); 
        }
    </script>
</head>
<body>

    <div id="login-section">
        <div class="login-container">
            <form id="login-form"><h2>Login</h2><div class="input-group"><label for="login-user">Email</label><input type="email" id="login-user" required></div><div class="input-group"><label for="login-password">Senha</label><input type="password" id="login-password" required></div><button type="submit" class="btn">Entrar</button><p id="login-error" class="error-message"></p><p class="forgot-password">Esqueci minha senha</p><p class="toggle-form" data-form="register">NÃ£o tem conta? Cadastre-se</p></form>
            <form id="register-form" style="display: none;">
                <h2>Cadastro</h2>
                <div class="input-group"><label for="register-user">Email</label><input type="email" id="register-user" required></div>
                <div class="input-group"><label for="register-company">Nome da Empresa</label><input type="text" id="register-company" required></div>
                <div class="input-group"><label for="register-password">Senha (mÃ­nimo 6 caracteres)</label><input type="password" id="register-password" minlength="6" required></div>
                <button type="submit" class="btn">Cadastrar</button>
                <p id="register-error" class="error-message"></p>
                <p class="toggle-form" data-form="login">JÃ¡ tem conta? FaÃ§a login</p>
            </form>
            <form id="reset-password-form" style="display: none;"><h2>Recuperar Senha</h2><div class="input-group"><label for="reset-email">Email</label><input type="email" id="reset-email" required></div><button type="submit" class="btn">Enviar email de recuperaÃ§Ã£o</button><p id="reset-message" class=""></p><p class="toggle-form" data-form="login">Voltar para o Login</p></form>
        </div>
    </div>
    <div id="app" class="container">
        <header>
            <div class="header-left">
                <h1 id="company-name">Painel Financeiro</h1>
                <div class="contact-links">
                    <a href="mailto:websitelogx@gmail.com">ğŸ“§ websitelogx@gmail.com</a>
                    <a href="https://www.websitelog.com.br" target="_blank">ğŸŒ www.websitelog.com.br</a>
                    <a href="https://wa.me/5534997824990" target="_blank">ğŸ“± (34) 99782-4990</a>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="logoutBtn" class="header-btn">Sair</button>
            </div>
        </header>
        <nav id="main-nav">
            <button class="tab-link active" data-tab="diagnostico">Empresa</button>
            <button class="tab-link hidden-tab" data-tab="entradas-diarias">Entradas DiÃ¡rias</button>
            <button class="tab-link" data-tab="entradas-mensais">Entradas Mensais</button>
            <button class="tab-link hidden-tab" data-tab="indicadores-mensais">Indicadores Mensais</button>
            <button class="tab-link hidden-tab" data-tab="indicadores-anuais">Indicadores Anuais</button>
            <button class="tab-link hidden-tab" data-tab="evolucao">EvoluÃ§Ã£o do NegÃ³cio</button>
            <button class="tab-link hidden-tab" data-tab="glossario">GlossÃ¡rio de Ajuda</button>
            <button class="tab-link hidden-tab" data-tab="diagnostico-consultor">DiagnÃ³stico do Consultor</button>
            <button class="tab-link" data-tab="configuracoes">âš™ï¸ ConfiguraÃ§Ãµes</button>
        </nav>
        <main>
            <!-- Aba Empresa -->
            <section id="diagnostico" class="tab-content active">
                <div class="section-header">
                    <h2>DiagnÃ³stico Empresarial</h2>
                    <div class="controls">
                        <button id="btn-export-company-xlsx" class="excel-btn">ğŸ“¤ Baixar Excel</button>
                        <label for="btn-import-company-xlsx" class="excel-btn file-btn">ğŸ“¥ Importar Excel</label>
                        <input type="file" id="btn-import-company-xlsx" accept=".xlsx, .xls" style="display: none;">
                        <button id="btn-export-company" class="pdf-btn">ğŸ“„ Baixar PDF</button>
                    </div>
                </div>
                <div class="card">
                    <p style="margin-bottom: 20px;">Preencha os dados abaixo para gerar um relatÃ³rio completo da saÃºde financeira da empresa.</p>
                    <form id="diagnosis-form">
                        <div class="diagnosis-form-grid">
                            <div class="input-group"><label for="diag-corporate-name">RazÃ£o Social / Nome Fantasia *</label><input type="text" id="diag-corporate-name" placeholder="Ex: Minha Loja Ltda" required></div>
                            <div class="input-group"><label for="diag-cnpj">CNPJ / CPF *</label><input type="text" id="diag-cnpj" placeholder="00.000.000/0001-00" required></div>
                            <div class="input-group"><label for="diag-responsible">Nome do ResponsÃ¡vel *</label><input type="text" id="diag-responsible" placeholder="JosÃ© da Silva" required></div>
                            <div class="input-group"><label for="diag-email">E-mail de Contato *</label><input type="email" id="diag-email" placeholder="contato@empresa.com" required></div>
                            <div class="input-group"><label for="diag-phone">WhatsApp / Telefone *</label><input type="tel" id="diag-phone" placeholder="(11) 99999-9999" required></div>
                            <div class="input-group"><label for="diag-sector">Setor de AtuaÃ§Ã£o</label><select id="diag-sector"><option value="ComÃ©rcio">ComÃ©rcio</option><option value="ServiÃ§os">ServiÃ§os</option><option value="IndÃºstria">IndÃºstria</option><option value="E-commerce">E-commerce</option><option value="Outro">Outro</option></select></div>
                            <div class="input-group"><label for="diag-tax-regime">Regime TributÃ¡rio</label><select id="diag-tax-regime"><option value="Simples Nacional">Simples Nacional</option><option value="Lucro Presumido">Lucro Presumido</option><option value="Lucro Real">Lucro Real</option><option value="MEI">MEI</option></select></div>
                            <h3 class="section-separator">PresenÃ§a Digital e Ferramentas Utilizadas</h3>
                            <div class="input-group"><label for="diag-erp">Utiliza ERP</label><select id="diag-erp"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-instagram">Tem Instagram</label><select id="diag-instagram"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-facebook">Tem Facebook</label><select id="diag-facebook"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-landingpage">Tem Landing Page</label><select id="diag-landingpage"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-site">Tem Site</label><select id="diag-site"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-ecommerce">Tem Loja Virtual</label><select id="diag-ecommerce"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-ads">Faz trÃ¡fego pago</label><select id="diag-ads"><option value="NÃ£o">NÃ£o</option><option value="Sim">Sim</option></select></div>
                            <div class="input-group"><label for="diag-marketplace">Vende em Marketplace â€” quais?</label><input type="text" id="diag-marketplace" placeholder="Ex: ML, Shopee, Amazon..."></div>
                            <h3 class="section-separator">ObservaÃ§Ãµes Gerais</h3>
                            <div class="input-group" style="grid-column: 1 / -1;"><label for="diag-observations">ObservaÃ§Ã£o ObrigatÃ³ria / Notas Adicionais</label><textarea id="diag-observations" rows="4" placeholder="Registre aqui observaÃ§Ãµes importantes sobre a empresa..."></textarea></div>
                        </div>
                        <button type="submit" class="btn" style="margin-top: 20px;">Salvar Dados da Empresa</button>
                    </form>
                </div>
            </section>

            <section id="entradas-diarias" class="tab-content">
                <div class="section-header">
                    <h2>LanÃ§amento DiÃ¡rio</h2>
                    <div class="controls">
                        <button id="btn-export-daily-xlsx" class="excel-btn">ğŸ“¤ Baixar Excel</button>
                        <label for="btn-import-daily-xlsx" class="excel-btn file-btn">ğŸ“¥ Importar Excel</label>
                        <input type="file" id="btn-import-daily-xlsx" accept=".xlsx, .xls" style="display: none;">
                        <button id="btn-export-daily" class="btn" style="background-color: #2e86de; color: white;">ğŸ“„ RelatÃ³rio DiÃ¡rio (PDF)</button>
                        <label for="daily-month-selector">MÃªs:</label>
                        <select id="daily-month-selector"></select>
                    </div>
                </div>
                <form id="daily-entry-form">
                    <div class="daily-entry-grid">
                        <div class="input-group"><label for="daily-date">Data</label><input type="date" id="daily-date" required></div>
                        <div class="input-group"><label for="daily-faturamento">Faturamento do Dia (R$)</label><input type="number" id="daily-faturamento" step="0.01" placeholder="Ex: 1500.50" required></div>
                        <div class="input-group"><label for="daily-despesas">Despesas do Dia (R$)</label><input type="number" id="daily-despesas" step="0.01" placeholder="Ex: 300.00" required></div>
                        <div class="input-group"><label for="daily-comissao">ComissÃ£o Vendedores (R$)</label><input type="number" id="daily-comissao" step="0.01" placeholder="Ex: 150.00"></div>
                        <div class="input-group"><label for="daily-outras">Outras Rec/Desp (R$)</label><input type="number" id="daily-outras" step="0.01" placeholder="Ex: -50.00"></div>
                        <div class="input-group"><label for="daily-vendas">Vendas do Dia (#)</label><input type="number" id="daily-vendas" step="1" placeholder="Ex: 25" required></div>
                        <button type="submit" class="btn">Adicionar LanÃ§amento</button>
                    </div>
                    <button type="button" id="cancel-edit-btn" class="btn danger" style="display: none; max-width: 200px; margin-top: -10px;">Cancelar EdiÃ§Ã£o</button>
                    <p id="daily-message" class="success-message"></p>
                </form>
                <div class="table-container">
                    <h3>LanÃ§amentos do MÃªs</h3>
                    <table id="daily-entries-table">
                        <thead>
                            <tr><th>Data</th><th>Faturamento (R$)</th><th>Despesas (R$)</th><th>ComissÃ£o (R$)</th><th>Outras Rec/Desp (R$)</th><th>NÂº de Vendas</th><th>AÃ§Ãµes</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            
            <section id="entradas-mensais" class="tab-content">
                <div class="section-header">
                    <h2>LanÃ§amentos Mensais <span id="auto-calc-notice">(Campos com * sÃ£o calculados automaticamente)</span></h2>
                    <div class="controls">
                        <button id="btn-export-monthly-xlsx" class="excel-btn">ğŸ“¤ Baixar Excel</button>
                        <label for="btn-import-monthly-xlsx" class="excel-btn file-btn">ğŸ“¥ Importar Excel</label>
                        <input type="file" id="btn-import-monthly-xlsx" accept=".xlsx, .xls" style="display: none;">
                        <button id="btn-export-monthly-inputs" class="pdf-btn">ğŸ“„ Baixar PDF</button>
                        <div class="checkbox-control"><input type="checkbox" id="allow-manual-edit"><label for="allow-manual-edit">Permitir ediÃ§Ã£o manual dos totais</label></div>
                        <label for="year-selector">Ano:</label>
                        <select id="year-selector"></select>
                        <button id="save-data" class="primary">ğŸ’¾ Salvar na Nuvem</button>
                        <button id="recalculate-all">ğŸ”„ Recalcular</button>
                    </div>
                </div>
                <div id="monthly-field-info" class="info-box" style="display:none;"><span id="monthly-field-text">Clique ou selecione um campo na tabela para ver a descriÃ§Ã£o detalhada aqui.</span></div>
                <div class="table-container">
                    <table id="monthly-inputs">
                        <thead><tr><th>MÃªs</th><th>Faturamento (R$)*</th><th>NÃºmero de Vendas*</th><th>Custos VariÃ¡veis (R$)*</th><th>Custos Fixos (R$)</th><th>Despesas Operacionais (R$)*</th><th>DepreciaÃ§Ã£o (R$)</th><th>Outras Receitas/Despesas (R$)*</th><th>Investimentos (CAPEX) (R$)</th><th>Financiamentos (Entradas) (R$)</th><th>AmortizaÃ§Ã£o de DÃ­vidas (SaÃ­das) (R$)</th><th>Aporte de SÃ³cios (R$)</th><th>DistribuiÃ§Ã£o de Lucros (R$)</th><th>Impostos (R$)</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="indicadores-mensais" class="tab-content"><div class="section-header"><h2>Indicadores Financeiros Mensais</h2><div class="controls"><button id="export-pdf-monthly" class="pdf-btn">ğŸ“„ Baixar PDF</button><button id="export-excel-monthly" class="excel-btn">ğŸ“¤ Baixar Excel</button></div></div><div class="table-container"><table id="monthly-indicators-table"><thead><tr><th>MÃªs</th><th>Lucro LÃ­quido</th><th>Margem LÃ­quida (%)</th><th>Markup (%)</th><th>Fluxo de Caixa Operacional</th><th>Fluxo de Caixa de Investimento</th><th>Fluxo de Caixa de Financiamento</th><th>Fluxo de Caixa Livre</th></tr></thead><tbody></tbody></table></div></section>
            
            <section id="indicadores-anuais" class="tab-content">
                <div class="section-header">
                    <h2>Indicadores Anuais e GestÃ£o da Conta</h2>
                    <div class="controls">
                        <button id="btn-export-annual-xlsx" class="excel-btn">ğŸ“¤ Baixar Excel</button>
                        <button id="btn-export-annual" class="pdf-btn">ğŸ“„ Baixar PDF</button>
                        <button id="recalculate-annual">ğŸ”„ Recalcular Indicadores</button>
                        <button id="delete-account-btn" class="danger">ğŸ—‘ï¸ Excluir Conta e Dados</button>
                    </div>
                </div>
                <div id="annual-indicators-content"></div>
                <div class="advice-section"><h2>ğŸ’¡ Plano de AÃ§Ã£o Personalizado</h2><div id="advice-container"><p>Preencha suas metas na aba 'ConfiguraÃ§Ãµes' para receber conselhos.</p></div></div>
            </section>
            
            <section id="evolucao" class="tab-content">
                <div class="section-header">
                    <h2>EvoluÃ§Ã£o do NegÃ³cio</h2>
                    <div class="controls">
                        <button id="btn-export-evolution-xlsx" class="excel-btn">ğŸ“¤ Baixar Excel</button>
                        <button id="btn-export-evolution" class="pdf-btn">ğŸ“„ Baixar PDF</button>
                    </div>
                </div>
                <div class="charts-container"><div class="chart-wrapper"><h3>EvoluÃ§Ã£o Mensal (Faturamento, Custos e Lucro)</h3><canvas id="monthlyEvolutionChart"></canvas></div><div class="chart-wrapper"><h3>EvoluÃ§Ã£o do Fluxo de Caixa Livre</h3><canvas id="cashFlowChart"></canvas></div></div>
            </section>
            
            <section id="glossario" class="tab-content">
                <div class="section-header">
                    <h2>GlossÃ¡rio de Termos Financeiros</h2>
                    <div class="controls"><button id="btn-export-glossary" class="pdf-btn">ğŸ“„ Baixar PDF</button></div>
                </div>
                <input type="text" id="glossary-search" placeholder="Busque por um indicador (ex: Lucro, ROI...)"><div id="glossary-container"></div>
            </section>
            
            <section id="diagnostico-consultor" class="tab-content">
                <div class="section-header">
                    <h2>DiagnÃ³stico do Consultor</h2>
                    <div class="controls">
                        <button id="btn-export-consultant" class="pdf-btn">ğŸ“„ PDF do Parecer</button>
                        <button id="btn-full-report" class="btn" style="background-color: #d4ac0d; color: #333;">ğŸ“„ Gerar RelatÃ³rio Completo</button>
                        <button id="save-consultant-diagnosis" class="primary">ğŸ’¾ Salvar Parecer</button>
                    </div>
                </div>
                <div class="card">
                    <p>EspaÃ§o reservado para o consultor descrever a anÃ¡lise detalhada da situaÃ§Ã£o financeira da empresa.</p>
                    <textarea id="consultant-diagnosis-text" rows="15" placeholder="Digite aqui o diagnÃ³stico completo, observaÃ§Ãµes e recomendaÃ§Ãµes estratÃ©gicas..." style="width: 100%; margin-top: 15px;"></textarea>
                </div>
            </section>

            <section id="configuracoes" class="tab-content">
                <div class="section-header">
                    <h2>ConfiguraÃ§Ãµes do NegÃ³cio</h2>
                    <div class="controls"><button id="save-settings" class="primary">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button></div>
                </div>
                <h3>Perfil do seu NegÃ³cio</h3>
                <p>Preencha para receber conselhos personalizados. Os valores de mÃ©dia sÃ£o sugestÃµes e podem ser ajustados.</p>
                <div class="settings-grid">
                    <div class="input-group"><label for="business-type">Qual o seu tipo de negÃ³cio?</label><select id="business-type"><option value="varejo">Varejo (Loja FÃ­sica)</option><option value="servicos">ServiÃ§os (AgÃªncia, Consultoria)</option><option value="ecommerce">E-commerce (Loja Online)</option><option value="restaurante">Restaurante / AlimentaÃ§Ã£o</option></select></div>
                    <div class="input-group"><label for="benchmark-margem">Meta de Margem LÃ­quida (%)</label><input type="number" id="benchmark-margem" placeholder="Ex: 15"></div>
                    <div class="input-group"><label for="benchmark-custos">Custo VariÃ¡vel MÃ¡ximo (% do Faturamento)</label><input type="number" id="benchmark-custos" placeholder="Ex: 40"></div>
                    <div class="input-group"><label for="benchmark-markup">Meta de Markup MÃ­nimo (%)</label><input type="number" id="benchmark-markup" placeholder="Ex: 120"></div>
                </div>
                
                <!-- Nova Ãrea de Dados de DemonstraÃ§Ã£o (Solicitada) -->
                <div class="demo-section">
                    <h3>ğŸ§ª SimulaÃ§Ã£o e Reset</h3>
                    <p><strong>AtenÃ§Ã£o:</strong> Esta funcionalidade irÃ¡ <strong>ZERAR (limpar)</strong> os dados atuais das abas <em>Empresa</em> e <em>Valores Mensais</em> e, em seguida, preenchÃª-los com dados fictÃ­cios de um comÃ©rcio com faturamento mÃ©dio de R$ 60.000,00.</p>
                    <p>Ao executar, a opÃ§Ã£o "Permitir ediÃ§Ã£o manual dos totais" serÃ¡ ativada automaticamente.</p>
                    <button id="btn-reset-populate-demo" class="btn" style="background-color: #6c5ce7; color: white; margin-top: 10px; max-width: 350px;">Simular Dados (Reset + R$ 60k)</button>
                </div>

                <div class="unlock-section">
                    <h3>ğŸ”“ Desbloqueio de FunÃ§Ãµes AvanÃ§adas</h3>
                    <p>Gere um cÃ³digo aleatÃ³rio e insira a contra-senha para visualizar todas as abas e cÃ¡lculos. Formato: <strong>CÃ“DIGO - DIAS</strong></p>
                    
                    <div id="access-status-display" class="access-info" style="display:none;">
                        <p><strong>Status:</strong> <span id="status-text"></span></p>
                        <p><strong>Expira em:</strong> <span id="expiration-text"></span></p>
                        <p><strong>Dias Restantes:</strong> <span id="days-left-text"></span></p>
                    </div>

                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px;">
                        <button id="btn-generate-unlock-code" class="btn" style="background-color: #d4ac0d; color: black; max-width: 250px;">Gerar CÃ³digo de Desbloqueio</button>
                        <span id="generated-code-display"></span>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button id="btn-test-access" class="btn" style="margin-top: 15px; background-color: #6c5ce7; color: white; max-width: 200px;">ğŸ§ª Teste (+1 Dia)</button>
                        <button id="btn-reset-auth" class="btn" style="margin-top: 15px; background-color: #e17055; color: white; max-width: 200px;">ğŸš« Zerar AutorizaÃ§Ã£o</button>
                    </div>
                </div>

                <div class="backup-area"><h3>ğŸ’¾ Backup e RestauraÃ§Ã£o de Dados</h3><p style="margin-bottom: 15px;">FaÃ§a o download de todos os seus dados para o computador ou restaure um arquivo salvo anteriormente. <strong>AtenÃ§Ã£o: A restauraÃ§Ã£o substitui todos os dados atuais.</strong></p><div class="backup-controls"><button id="btn-backup-local" class="btn" style="background-color: #2e86de;">â¬‡ï¸ Baixar Backup (Local)</button><button id="btn-restore-local" class="btn" style="background-color: #27ae60;">â¬†ï¸ Restaurar Backup</button><input type="file" id="input-restore-file" accept=".json" style="display: none;"></div></div>
            </section>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <!-- Bibliotecas Externas -->
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- LÃ³gica Principal -->
    <script src="script.js"></script>
</body>
</html>